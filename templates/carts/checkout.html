{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Favicon icon-->
    {% include 'base/css.html' %}
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="{% static 'images/favicon/favicon.ico' %}"
    />

    <title>Checkout |</title>
  </head>

  <body>
    <!-- Page content -->
    {% include 'base/navbar.html' %}

    <!-- Page header -->
    <div class="py-lg-6 py-4 bg-dark">
      <div class="container">
        <div class="row">
          <div class="col-xl-12 col-lg-12 col-md-12 col-12">
            <div>
              <h1 class="text-white display-4 mb-0">Checkout</h1>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Content -->
    <div class="py-6">
      <div class="container">
        <div class="row">
          <div class="col-xl-8 col-lg-8 col-md-12 col-12">
            <!-- Card -->
            <div class="card mb-3  mb-lg-0">
              <!-- Card header -->
              <div class="card-header">
                <h3 class="mb-0">Payment Method</h3>
              </div>
              <!-- Card body -->
              <div class="card-body">
                <div class="d-inline-flex">
                   <!-- Radio -->
                  <div class="form-check">
                    <input
                      type="radio"
                      id="cardRadioTwo"
                      name="cardRadioone"
                      class="form-check-input"
                      checked
                    />
                    <img src="{% static 'images/brand/paypal.svg' %}" />
                  </div>
                  <div class="form-check me-3">
                    <input
                      type="radio"
                      id="cardRadioone"
                      name="cardRadioone"
                      class="form-check-input"
                      
                    />
                    <label class="form-check-label" for="cardRadioone"
                      >Credit or Debit card</label
                    >
                  </div>
                 
                </div>
                <!-- Form -->
                <!-- Paypal -->
                <form id="internetpayment">
                  <div class="mb-3 mt-4 col-lg-4 col-md-4, col-sm-6 col-6">
                    <div id="paypal-button-container"></div>
                  </div>
                </form>
                <form class="row" id="cardpayment">
                  <!-- Card number -->
                  <div class="mb-3 mt-4 col-12">
                    <!-- Card Number -->
                    <label
                      class="
                        d-flex
                        justify-content-between
                        align-items-center
                        form-label
                      "
                      for="cc-mask"
                      >Card Number
                      <span
                        ><i class="fab fa-cc-amex me-1 text-primary"></i
                        ><i class="fab fa-cc-mastercard me-1 text-primary"></i>
                        <i class="fab fa-cc-discover me-1 text-primary"></i>
                        <i class="fab fa-cc-visa text-primary"></i></span
                    ></label>
                    <div class="input-group">
                      <input
                        type="text"
                        class="form-control"
                        id="cc-mask"
                        data-inputmask="'mask': '9999 9999 9999 9999'"
                        inputmode="numeric"
                        placeholder="xxxx-xxxx-xxxx-xxxx"
                        required
                      />
                      <span class="input-group-text" id="basic-addon2"
                        ><i class="fe fe-lock"></i
                      ></span>
                    </div>
                    <small class="text-muted"
                      >Full name as displayed on card.</small
                    >
                  </div>
                  <!-- Month -->
                  <div class="mb-3 col-12 col-md-4">
                    <label class="form-label">Month</label>
                    <select class="selectpicker" data-width="100%">
                      <option value="">Month</option>
                      <option value="June">June</option>
                      <option value="July">July</option>
                      <option value="August">August</option>
                      <option value="Sep">Sep</option>
                      <option value="Oct">Oct</option>
                    </select>
                  </div>
                  <!-- Year -->
                  <div class="mb-3 col-12 col-md-4">
                    <label class="form-label">Year</label>
                    <select class="selectpicker" data-width="100%">
                      <option value="">Year</option>
                      <option value="June">2018</option>
                      <option value="July">2019</option>
                      <option value="August">2020</option>
                      <option value="Sep">2021</option>
                      <option value="Oct">2022</option>
                    </select>
                  </div>
                  <!-- CVV Code -->
                  <div class="mb-3 col-12 col-md-4">
                    <label for="cvv" class="form-label"
                      >CVV Code
                      <i
                        class="fe fe-help-circle ms-1 fs-6"
                        data-bs-toggle="tooltip"
                        data-placement="right"
                        title=""
                        data-original-title="A 3 - digit number, typically printed on the back of a card."
                      ></i
                    ></label>
                    <input
                      type="password"
                      class="cc-inputmask form-control"
                      name="cvv"
                      id="cvv"
                      placeholder="xxx"
                      maxlength="3"
                    />
                  </div>
                  <!-- Name on card -->
                  <div class="mb-3 col-12">
                    <label for="nameoncard" class="form-label"
                      >Name on Card</label
                    >
                    <input
                      id="nameoncard"
                      type="text"
                      class="form-control"
                      name="nameoncard"
                      placeholder="Name"
                      required
                    />
                  </div>
                  <!-- Country -->
                  <div class="mb-3 col-6">
                    <label class="form-label">Country</label>
                    <select class="selectpicker" data-width="100%">
                      <option value="">India</option>
                      <option value="uk">UK</option>
                      <option value="usa">USA</option>
                    </select>
                  </div>
                  <!-- Zip Code -->
                  <div class="mb-3 col-6">
                    <label for="postalcode" class="form-label"
                      >Zip/Postal Code</label
                    >
                    <input
                      id="postalcode"
                      type="text"
                      class="form-control"
                      name="postalcode"
                      placeholder="Zipcode"
                      required
                    />
                  </div>
                  <!-- CheckBox -->
                  <div class="col-12 mb-5">
                    <div class="form-check">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        id="customCheck1"
                      />
                      <label class="form-check-label" for="customCheck1"
                        >Remember this card</label
                      >
                    </div>
                  </div>
                  <div class="col-md-4 col-12">
                    <!-- Button -->
                    <div>
                      <button
                        type="submit"
                        class="btn btn-primary mb-3 mb-lg-0 me-4"
                      >
                        Make a Payment
                      </button>
                    </div>
                  </div>
                  <!-- Text -->
                  <div
                    class="
                      col-md-8 col-12
                      d-flex
                      align-items-center
                      justify-content-end
                    "
                  >
                    <small class="mb-0"
                      >By click start learning, you agree to our
                      <a href="#"
                        >Terms of Service and Privacy Policy.</a
                      ></small
                    >
                  </div>
                </form>
                
              </div>
            </div>
            
            <div class="card-header mt-5">
              <h3 class="mb-0 navbar-cart-count" >
                Order details 
                
              </h3>
            </div>
            <div class="card mb-4">
              <div class="table-responsive border-0 overflow-y-hidden">
                <table class="table mb-0 text-nowrap">
                  <thead>
                    <tr>
                      <th scope="col" class="border-0">Courses</th>
                      <th scope="col" class="border-0">Students</th>
                      <th scope="col" class="border-0">Rating</th>
                      <th scope="col" class="border-0">Price</th>
                      <th scope="col" class="border-0"></th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for course in object.courses.all %}
                    <tr>
                      <td class="border-top-0">
                        <div class="d-lg-flex">
                          <div>
                            <a href="#">
                              <img
                                src="{{ course.files.last.get_download_url }}"
                                alt=""
                                class="rounded img-4by3-lg"
                            /></a>
                          </div>
                          <div class="ms-lg-3 mt-2 mt-lg-0">
                            <h4 class="mb-1 h5">
                              <a href="#" class="text-inherit">
                                {{ course.title }}
                              </a>
                            </h4>
                            <ul class="list-inline fs-6 mb-0">
                              <li class="list-inline-item">
                                <i class="far fa-clock me-1"></i>1h 30m
                              </li>
                              <li class="list-inline-item">
                                <svg
                                  class="me-1 mt-n1"
                                  width="16"
                                  height="16"
                                  viewBox="0 0 16 16"
                                  fill="none"
                                  xmlns="http://www.w3.org/2000/svg"
                                >
                                  <rect
                                    x="3"
                                    y="8"
                                    width="2"
                                    height="6"
                                    rx="1"
                                    fill="#754FFE"
                                  ></rect>
                                  {% if course.level == 'basic' %}
                                  <rect
                                    x="7"
                                    y="5"
                                    width="2"
                                    height="9"
                                    rx="1"
                                    fill="#DBD8E9"
                                  ></rect>
                                  <rect
                                    x="11"
                                    y="2"
                                    width="2"
                                    height="12"
                                    rx="1"
                                    fill="#DBD8E9"
                                  ></rect>
    
                                  {% elif course.level == 'intermediate' %}
                                  <rect
                                    x="7"
                                    y="5"
                                    width="2"
                                    height="9"
                                    rx="1"
                                    fill="#754FFE"
                                  ></rect>
                                  <rect
                                    x="11"
                                    y="2"
                                    width="2"
                                    height="12"
                                    rx="1"
                                    fill="#DBD8E9"
                                  ></rect>
    
                                  {% else %}
                                  <rect
                                    x="7"
                                    y="5"
                                    width="2"
                                    height="9"
                                    rx="1"
                                    fill="#754FFE"
                                  ></rect>
                                  <rect
                                    x="11"
                                    y="2"
                                    width="2"
                                    height="12"
                                    rx="1"
                                    fill="#754FFE"
                                  ></rect>
                                  {% endif %}</svg>
                                  {{ course.get_level_display }}
                              </li>
                            </ul>
                          </div>
                        </div>
                      </td>
                      <td class="border-top-0">11,200</td>
                      <td class="border-top-0">
                        <span class="text-warning"
                          >4.5<i class="mdi mdi-star"></i></span
                        >(3,250)
                      </td>
    
                      <td class="border-top-0">
                        <h6 class="mb-1 display-6 text-danger">
                          ${{ course.price | floatformat:"0" }}
                        </h6>
                      </td>
    
                      
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="col-lg-4 col-md-12 col-12">
            <!-- Card -->
            <div class="card border-0 mb-3">
              <div class="card-header">
                <h3 class="mb-0">Summary</h3>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-6">
                    <label class="form-label">Subtotal:</label>
                  </div>
                  <div class="col-6">
                    <label class="form-label">${{ object.subtotal }}</label>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6">
                    <label class="form-label">Estimated Tax:</label>
                  </div>
                  <div class="col-6">
                    <label class="form-label">$0</label>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6">
                    <div class="display-6 text-primary">Total</div>
                  </div>
                  <div class="col-6">
                    <div class="display-4 display-6 text-primary">
                      ${{ object.total | floatformat:"0"}}
                    </div>
                  </div>
                </div>

              </div>
              <hr class="m-0" />
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Footer -->
    <!-- Footer -->
    <div class="footer">
      <div class="container">
        <div class="row align-items-center g-0 border-top py-2">
          <!-- Desc -->
          <div class="col-md-6 col-12 text-center text-md-start">
            <span>© 2021 READuced. All Rights Reserved.</span>
          </div>
          <!-- Links -->
          <div class="col-12 col-md-6">
            <nav
              class="
                nav nav-footer
                justify-content-center justify-content-md-end
              "
            >
              <a class="nav-link active ps-0" href="#">Privacy</a>
              <a class="nav-link" href="#">Terms </a>
              <a class="nav-link" href="#">Feedback</a>
              <a class="nav-link" href="#">Support</a>
            </nav>
          </div>
        </div>
      </div>
    </div>

    {% include 'base/js.html' %}

    <script>
      var courseId = "{{ object.id }}";

      function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          var cookies = document.cookie.split(";");
          for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }

      var csrftoken = getCookie("csrftoken");
      const url = "{% url 'cart_checkout_api' %}";
      const redirectURL =  "{% url 'checkout_done' %}";
      function completeOrder(data) {
        return fetch(url, {
          method: "POST",
          headers: {
            "Content-type": "application/json",
            "X-CSRFToken": csrftoken,
          },
          body: JSON.stringify({
            orderID: data.orderID,
          }),
        })
          .then((res) => res.json())
          .then((details) => {
            console.log("Details: ", details);
            window.location.replace(redirectURL)
            //alert('Transaction funds captured from ' + details.payer_given_name);
          });
      }
      var FUNDING_SOURCES = [paypal.FUNDING.PAYPAL];

      FUNDING_SOURCES.forEach(function (fundingSource) {
        var button = paypal.Buttons({
          fundingSource: fundingSource,
          style: {
            color: "black",
            shape: "pill",
            label: "checkout",
            height: 40,
            size: "small",
          },
          createOrder: function (data, actions) {
            return actions.order.create({
              purchase_units: [
                {
                  amount: {
                    value: "{{ object.total  }}",
                  },
                },
              ],
            });
          },
          onApprove: function (data, actions) {
            return completeOrder(data);
          },
        });
        if (button.isEligible()) {
          button.render("#paypal-button-container");
        }
      });

      // Display payment options on your web page
    </script>
  </body>
</html>
