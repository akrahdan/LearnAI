{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Favicon icon-->
    {% include 'base/css.html' %}
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="{% static 'images/favicon/favicon.ico' %}"
    />

    <title>Checkout |</title>
  </head>

  <body>
    <!-- Page content -->
    {% include 'base/navbar.html' %}

    <!-- Page header -->
    <div class="py-lg-6 py-4 bg-dark">
      <div class="container">
        <div class="row">
          <div class="col-xl-12 col-lg-12 col-md-12 col-12">
            <div>
              <h1 class="text-white display-4 mb-0">Checkout</h1>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Content -->
    <div class="py-6">
      <div class="container">
        <div class="row">
          <div class="col-xl-8 col-lg-8 col-md-12 col-12">
            <!-- Card -->
            <div class="card mb-3 mb-lg-0">
              <!-- Card header -->
              <div class="card-header">
                <h3 class="mb-0">Payment Method</h3>
              </div>
              <!-- Card body -->
              <div class="card-body">
                <div class="d-inline-flex">
                  <div class="form-check me-3">
                    <input
                      type="radio"
                      id="cardRadioone"
                      name="cardRadioone"
                      class="form-check-input"
                      checked
                    />
                    <label class="form-check-label" for="cardRadioone"
                      >Credit or Debit card</label
                    >
                  </div>
                  <!-- Radio -->
                  <div class="form-check">
                    <input
                      type="radio"
                      id="cardRadioTwo"
                      name="cardRadioone"
                      class="form-check-input"
                    />
                    <img src="{% static 'images/brand/paypal.svg' %}" />
                  </div>
                </div>
                <!-- Form -->
                <form class="row" id="cardpayment">
                  <!-- Card number -->
                  <div class="mb-3 mt-4 col-12">
                    <!-- Card Number -->
                    <label
                      class="
                        d-flex
                        justify-content-between
                        align-items-center
                        form-label
                      "
                      for="cc-mask"
                      >Card Number
                      <span
                        ><i class="fab fa-cc-amex me-1 text-primary"></i
                        ><i class="fab fa-cc-mastercard me-1 text-primary"></i>
                        <i class="fab fa-cc-discover me-1 text-primary"></i>
                        <i class="fab fa-cc-visa text-primary"></i></span
                    ></label>
                    <div class="input-group">
                      <input
                        type="text"
                        class="form-control"
                        id="cc-mask"
                        data-inputmask="'mask': '9999 9999 9999 9999'"
                        inputmode="numeric"
                        placeholder="xxxx-xxxx-xxxx-xxxx"
                        required
                      />
                      <span class="input-group-text" id="basic-addon2"
                        ><i class="fe fe-lock"></i
                      ></span>
                    </div>
                    <small class="text-muted"
                      >Full name as displayed on card.</small
                    >
                  </div>
                  <!-- Month -->
                  <div class="mb-3 col-12 col-md-4">
                    <label class="form-label">Month</label>
                    <select class="selectpicker" data-width="100%">
                      <option value="">Month</option>
                      <option value="June">June</option>
                      <option value="July">July</option>
                      <option value="August">August</option>
                      <option value="Sep">Sep</option>
                      <option value="Oct">Oct</option>
                    </select>
                  </div>
                  <!-- Year -->
                  <div class="mb-3 col-12 col-md-4">
                    <label class="form-label">Year</label>
                    <select class="selectpicker" data-width="100%">
                      <option value="">Year</option>
                      <option value="June">2018</option>
                      <option value="July">2019</option>
                      <option value="August">2020</option>
                      <option value="Sep">2021</option>
                      <option value="Oct">2022</option>
                    </select>
                  </div>
                  <!-- CVV Code -->
                  <div class="mb-3 col-12 col-md-4">
                    <label for="cvv" class="form-label"
                      >CVV Code
                      <i
                        class="fe fe-help-circle ms-1 fs-6"
                        data-bs-toggle="tooltip"
                        data-placement="right"
                        title=""
                        data-original-title="A 3 - digit number, typically printed on the back of a card."
                      ></i
                    ></label>
                    <input
                      type="password"
                      class="cc-inputmask form-control"
                      name="cvv"
                      id="cvv"
                      placeholder="xxx"
                      maxlength="3"
                    />
                  </div>
                  <!-- Name on card -->
                  <div class="mb-3 col-12">
                    <label for="nameoncard" class="form-label"
                      >Name on Card</label
                    >
                    <input
                      id="nameoncard"
                      type="text"
                      class="form-control"
                      name="nameoncard"
                      placeholder="Name"
                      required
                    />
                  </div>
                  <!-- Country -->
                  <div class="mb-3 col-6">
                    <label class="form-label">Country</label>
                    <select class="selectpicker" data-width="100%">
                      <option value="">India</option>
                      <option value="uk">UK</option>
                      <option value="usa">USA</option>
                    </select>
                  </div>
                  <!-- Zip Code -->
                  <div class="mb-3 col-6">
                    <label for="postalcode" class="form-label"
                      >Zip/Postal Code</label
                    >
                    <input
                      id="postalcode"
                      type="text"
                      class="form-control"
                      name="postalcode"
                      placeholder="Zipcode"
                      required
                    />
                  </div>
                  <!-- CheckBox -->
                  <div class="col-12 mb-5">
                    <div class="form-check">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        id="customCheck1"
                      />
                      <label class="form-check-label" for="customCheck1"
                        >Remember this card</label
                      >
                    </div>
                  </div>
                  <div class="col-md-4 col-12">
                    <!-- Button -->
                    <div>
                      <button
                        type="submit"
                        class="btn btn-primary mb-3 mb-lg-0 me-4"
                      >
                        Make a Payment
                      </button>
                    </div>
                  </div>
                  <!-- Text -->
                  <div
                    class="
                      col-md-8 col-12
                      d-flex
                      align-items-center
                      justify-content-end
                    "
                  >
                    <small class="mb-0"
                      >By click start learning, you agree to our
                      <a href="#"
                        >Terms of Service and Privacy Policy.</a
                      ></small
                    >
                  </div>
                </form>
                <!-- Paypal -->
                <form id="internetpayment">
                  <div class="mb-3 mt-4 col-lg-4 col-md-4, col-sm-6 col-6">
                    <div id="paypal-button-container"></div>
                  </div>
                </form>
              </div>
            </div>
          </div>

         
          <div class="col-lg-4 col-md-12 col-12">
            <!-- Card -->
            <div class="card border-0 mb-3">
              <!-- Card body -->
              <div class="card mb-3 mb-4">
                <div class="p-1">
                  <div
                    class="
                      d-flex
                      justify-content-center
                      position-relative
                      rounded
                      py-10
                      border-white border
                      rounded-3
                      bg-cover
                    "
                    style="background-image: url('{{ object.files.last.get_download_url }}')"
                  >
                    <a
                      class="
                        popup-youtube
                        icon-shape
                        rounded-circle
                        btn-play
                        icon-xl
                        text-decoration-none
                      "
                      href="{{ object.video_url }}"
                    >
                      <i class="fe fe-play"></i>
                    </a>
                  </div>
                </div>
              </div>
              <div class="p-5 text-center">
                <span class="badge bg-warning">Selected Course</span>
                <div class="mb-5 mt-3">
                  <h1 class="fw-bold">{{ object.title }}</h1>
                  <p class="mb-0">
                    {{ object.description | truncatewords:20 }}
                  </p>
                </div>
                <div class="d-flex justify-content-center">
                  <span class="h3 mb-0 fw-bold text-primary">$</span>
                  <div class="display-4 fw-bold text-primary">
                    {{ object.price | floatformat:"0"}}
                  </div>
                </div>
              </div>
              <hr class="m-0" />
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Footer -->
    <!-- Footer -->
    <div class="footer">
      <div class="container">
        <div class="row align-items-center g-0 border-top py-2">
          <!-- Desc -->
          <div class="col-md-6 col-12 text-center text-md-start">
            <span>© 2021 READuced. All Rights Reserved.</span>
          </div>
          <!-- Links -->
          <div class="col-12 col-md-6">
            <nav
              class="
                nav nav-footer
                justify-content-center justify-content-md-end
              "
            >
              <a class="nav-link active ps-0" href="#">Privacy</a>
              <a class="nav-link" href="#">Terms </a>
              <a class="nav-link" href="#">Feedback</a>
              <a class="nav-link" href="#">Support</a>
            </nav>
          </div>
        </div>
      </div>
    </div>

    {% include 'base/js.html' %}

    <script>
      var courseId = '{{ object.id }}'


      function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          var cookies = document.cookie.split(";");
          for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }

      var csrftoken = getCookie("csrftoken");
      const url = "{% url 'complete_order' %}"
      function completeOrder(data) {
        
        return fetch(url, {
          method: 'POST',
          headers: {
            'Content-type': 'application/json',
            'X-CSRFToken': csrftoken
          },
          body: JSON.stringify({
            orderID: data.orderID,
            courseId: courseId
          })
           
        }).then(res => res.json())
        .then(details => {
          console.log('Details: ', details)
          //alert('Transaction funds captured from ' + details.payer_given_name);
        })
       
      }
      var FUNDING_SOURCES = [paypal.FUNDING.PAYPAL];

      FUNDING_SOURCES.forEach(function (fundingSource) {
        var button = paypal.Buttons({
          fundingSource: fundingSource,
          style: {
            color: "black",
            shape: "pill",
            label: "checkout",
            height: 40,
            size: "small",
          },
          createOrder: function (data, actions) {
            return actions.order.create({
              purchase_units: [
                {
                  amount: {
                    value: "{{ object.price  }}",
                  },
                },
              ],
            });
          },
          onApprove: function (data, actions) {
            return completeOrder(data)
          },
        });
        if (button.isEligible()) {
          button.render("#paypal-button-container");
        }
      });

      // Display payment options on your web page
    </script>
  </body>
</html>
